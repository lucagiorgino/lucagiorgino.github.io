<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Malware analysis - an introduction | Luca Giorgino</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lucagiorgino.github.io/img/luca-social-card.png"><meta data-rh="true" name="twitter:image" content="https://lucagiorgino.github.io/img/luca-social-card.png"><meta data-rh="true" property="og:url" content="https://lucagiorgino.github.io/blog/malware-analysis"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Malware analysis - an introduction | Luca Giorgino"><meta data-rh="true" name="description" content="Malware analysis requires a structured approach to extract and understand hidden threats within various file formats and languages. By using the right tools, malware analysts can effectively deobfuscate, detect, and mitigate malicious payloads before they cause harm."><meta data-rh="true" property="og:description" content="Malware analysis requires a structured approach to extract and understand hidden threats within various file formats and languages. By using the right tools, malware analysts can effectively deobfuscate, detect, and mitigate malicious payloads before they cause harm."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2025-04-07T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/lucagiorgino"><meta data-rh="true" property="article:tag" content="security,malware-analysis"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lucagiorgino.github.io/blog/malware-analysis"><link data-rh="true" rel="alternate" href="https://lucagiorgino.github.io/blog/malware-analysis" hreflang="en"><link data-rh="true" rel="alternate" href="https://lucagiorgino.github.io/blog/malware-analysis" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://lucagiorgino.github.io/blog/malware-analysis","mainEntityOfPage":"https://lucagiorgino.github.io/blog/malware-analysis","url":"https://lucagiorgino.github.io/blog/malware-analysis","headline":"Malware analysis - an introduction","name":"Malware analysis - an introduction","description":"Malware analysis requires a structured approach to extract and understand hidden threats within various file formats and languages. By using the right tools, malware analysts can effectively deobfuscate, detect, and mitigate malicious payloads before they cause harm.","datePublished":"2025-04-07T00:00:00.000Z","author":{"@type":"Person","name":"Luca Giorgino","description":"Me","url":"https://github.com/lucagiorgino","image":"https://github.com/lucagiorgino.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://lucagiorgino.github.io/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Luca Giorgino RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Luca Giorgino Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6XTZ9YMEBB"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-6XTZ9YMEBB",{anonymize_ip:!0})</script>




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.ffbec4e5.css">
<script src="/assets/js/runtime~main.a59f342b.js" defer="defer"></script>
<script src="/assets/js/main.7a9a5814.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Luca Giorgino</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/lucagiorgino/lucagiorgino.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/malware-analysis">Malware analysis - an introduction</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/keystone-enclave">Keystone Enclave</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/what-i-learnt-using-actix-web">What I learnt using Actix-web</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/how-i-structure-my-react-applications">How I structure my React applications</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">Malware analysis - an introduction</h1><div class="container_mt6G margin-vert--md"><time datetime="2025-04-07T00:00:00.000Z">April 7, 2025</time> · <!-- -->16 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/lucagiorgino" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://github.com/lucagiorgino.png" alt="Luca Giorgino"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/lucagiorgino" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luca Giorgino</span></a></div><small class="authorTitle_nd0D" title="Me">Me</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>Malware analysis requires a <em>structured approach</em> to extract and understand <em>hidden threats</em> within various file formats and languages. By using the right tools, malware analysts can effectively deobfuscate, detect, and mitigate <em>malicious payloads</em> before they cause harm.</p>
<p>The following are some notes from the Udemy (italian) course: <a href="https://www.udemy.com/course/intro_malware_analisi/?referralCode=14E06E7C35D50C69D957" target="_blank" rel="noopener noreferrer">Introduzione alla malware analysis: Un approccio pratico</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="environment-for-malware-analysis">Environment for malware analysis<a href="#environment-for-malware-analysis" class="hash-link" aria-label="Direct link to Environment for malware analysis" title="Direct link to Environment for malware analysis">​</a></h2>
<p><a href="https://en.wikipedia.org/wiki/Malware" target="_blank" rel="noopener noreferrer">Malware</a> refers to any software program or code specifically designed to exploit, damage, disrupt, or gain unauthorized access to computer systems, networks, or data. Malware operates covertly, often without user consent.</p>
<p>Here are some blog posts for further reading:</p>
<ul>
<li>The 12 Most Common Types of Malware: <a href="https://www.crowdstrike.com/en-us/cybersecurity-101/malware/types-of-malware/" target="_blank" rel="noopener noreferrer">https://www.crowdstrike.com/en-us/cybersecurity-101/malware/types-of-malware/</a></li>
<li>Malware Analysis Explained: <a href="https://www.crowdstrike.com/en-us/cybersecurity-101/malware/malware-analysis/" target="_blank" rel="noopener noreferrer">https://www.crowdstrike.com/en-us/cybersecurity-101/malware/malware-analysis/</a></li>
</ul>
<p>A secure and controlled environment is crucial for effective malware analysis, often utilizing virtual machines, sandboxing tools, and forensic utilities to prevent system compromise and facilitate safe examination.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="host-requirements">Host requirements<a href="#host-requirements" class="hash-link" aria-label="Direct link to Host requirements" title="Direct link to Host requirements">​</a></h3>
<ul>
<li>Virtualization software like <a href="https://www.virtualbox.org/" target="_blank" rel="noopener noreferrer">Virtual Box</a> with an installed operating system suited to the target malware under analysis,</li>
<li>Windows 10 media creation tool: <a href="https://www.microsoft.com/it-it/software-download/windows10" target="_blank" rel="noopener noreferrer">https://www.microsoft.com/it-it/software-download/windows10</a>,</li>
<li>When using a <em>shared folder</em> between the host and guest, always set it to <strong>read-only</strong> to prevent malware from writing files to the host system,</li>
<li>Ensure to allocate an appropriate number of processor cores and memory, as some malware perform environment checks to detect virtualized environments and may terminate execution if the resources appear insufficient or unrealistic.</li>
</ul>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>In some situations, malware can exploit vulnerabilities in virtualization software, potentially escaping the virtual environment and compromising the host system.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="guest-requirements">Guest requirements<a href="#guest-requirements" class="hash-link" aria-label="Direct link to Guest requirements" title="Direct link to Guest requirements">​</a></h3>
<p>Install the operating system required for the malware analysis environment.</p>
<p><strong>Common analysis tools</strong>:</p>
<ul>
<li>Editor tool of your choice, example <a href="https://notepad-plus-plus.org/downloads/" target="_blank" rel="noopener noreferrer">Notepad++</a>,</li>
<li><a href="https://www.python.org/" target="_blank" rel="noopener noreferrer">Python</a>, high-level programming language,</li>
<li><a href="https://www.7-zip.org/" target="_blank" rel="noopener noreferrer">7-zip</a>, open source software for compression/decompression of various file formats,</li>
<li><a href="https://ntcore.com/explorer-suite/" target="_blank" rel="noopener noreferrer">CFF explorer</a>, binary editor - tool used to analyse and modify files in binary format,</li>
<li><a href="https://systeminformer.com/" target="_blank" rel="noopener noreferrer">System Informer</a>, tool that helps you monitor system resources, debug software and detect malware,</li>
<li><a href="https://github.com/horsicq/Detect-It-Easy" target="_blank" rel="noopener noreferrer">Detect it easy</a>, program for determining types of files,</li>
<li><a href="https://github.com/VirusTotal/yara" target="_blank" rel="noopener noreferrer">Yara</a>, used to identity malware,</li>
<li><a href="https://learn.microsoft.com/en-en/sysinternals/" target="_blank" rel="noopener noreferrer">Sysinternals</a>, set of utilities for troubleshooting and diagnosing Windows and Linux systems and applications,</li>
<li><a href="https://www.telerik.com/fiddler" target="_blank" rel="noopener noreferrer">Fiddler proxy</a>, HTTP/HTTPS system proxy, used to inspect network requests. To inspect traffic over TLS ensure to enable the correct setting. <code>Tools-&gt;Options-&gt;HTTPS</code>: Check <code>Decrypt HTTPs traffic</code>, Install certificate, Check &quot;Ignore server certificate errors&quot;,</li>
<li><a href="https://www.wireshark.org/" target="_blank" rel="noopener noreferrer">Wireshark</a>, tool for inspecting network traffic across various protocols beyond just HTTP/HTTPS.</li>
<li>(optional) <a href="https://github.com/ionuttbara/windows-defender-remover" target="_blank" rel="noopener noreferrer">Windows Defender Remover</a>, a tool which is uses to remove Windows Defender.</li>
</ul>
<p>It is recommended to create virtual machine <strong>snapshots</strong> to easily restore the system to a clean state after each analysis, examples:</p>
<ul>
<li><code>vanilla</code> - a clean, fresh OS installation</li>
<li><code>ready-to-play</code> - OS + analysis tools</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="windows---things-to-know">Windows - things to know<a href="#windows---things-to-know" class="hash-link" aria-label="Direct link to Windows - things to know" title="Direct link to Windows - things to know">​</a></h4>
<ul>
<li><a href="https://learn.microsoft.com/en-us/windows/win32/sysinfo/registry" target="_blank" rel="noopener noreferrer">Windows Registry</a>: system-defined database in which applications and system components store and retrieve configuration data. It can be accessed using <code>WIN+R</code> and typing <code>regedit</code>:<!-- -->
<ul>
<li>administrator rights are required to modify the registry. Malware often targets <code>HKEY_CURRENT_USER</code>, <code>HKEY_USERS</code>, and <code>HKEY_LOCAL_MACHINE</code> keys,</li>
<li>malware leverages the registry for persistence, such as configuring automatic execution at start-up. For example, <code>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce</code> can be used to launch malware on boot (more information <a href="https://attack.mitre.org/techniques/T1547/001/" target="_blank" rel="noopener noreferrer">here</a>).</li>
<li>each user has a unique identifier within the Windows Registry,</li>
<li>the Registry is a valuable resource in forensic analysis to assess system state and detect anomalies,</li>
<li>before executing malware, exporting Registry values can be useful for comparison after execution to identify changes made by the malware,</li>
</ul>
</li>
<li>when executed, malware typically follows an installation routine to avoid easy deletion from directories like  <code>Downloads</code>. It often installs itself in the <code>AppData</code> folder (<code>%APPDATA%</code> - a Windows environment variable)  to maintain persistence,</li>
<li>Windows Shortcut (<code>.lnk</code>) are often used as an attack vector to run malicious code.</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>When analysing malware, <em>disable updates and Windows Defender</em>, then <em>add the user folder to the exclusion list</em> to prevent automatic detection and removal of the malware during the analysis process. Disable Hide settings and show extensions.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="threat-hunting-and-malware-triage">Threat Hunting and Malware Triage<a href="#threat-hunting-and-malware-triage" class="hash-link" aria-label="Direct link to Threat Hunting and Malware Triage" title="Direct link to Threat Hunting and Malware Triage">​</a></h2>
<p><strong>Threat Hunting</strong> is a proactive cybersecurity process involving the systematic search for threats. More <a href="https://www.crowdstrike.com/en-us/cybersecurity-101/threat-intelligence/threat-hunting/" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>Below are some key resources commonly used by analysts:</p>
<ul>
<li><a href="https://bazaar.abuse.ch/" target="_blank" rel="noopener noreferrer">MalwareBazaar</a> is a platform for sharing and analysing malware samples. Malware files are typically <em>compressed and password-protected</em> to prevent accidental execution and reduce the risk of unintended infections,</li>
<li><a href="https://www.virustotal.com/" target="_blank" rel="noopener noreferrer">Virus Total</a>: is an <em>antivirus aggregator</em> that scans files and URLs using multiple security engines to detect threats. A <em>subscription is recommended</em> for advanced features like deeper analysis, historical data, and threat intelligence insights,</li>
<li><a href="https://www.hybrid-analysis.com/" target="_blank" rel="noopener noreferrer">Hybrid Analysis</a>: free malware analysis service for the community that detects and analyses unknown threats.</li>
</ul>
<p><strong>Phases of Malware Triage</strong></p>
<ol>
<li><strong>Identify file type</strong> - Determine the file format to understand how it operates and what tools are needed for analysis:<!-- -->
<ul>
<li>use <a href="https://github.com/horsicq/Detect-It-Easy" target="_blank" rel="noopener noreferrer">Detect it easy</a>: analyse the file and add extensions if applicable,</li>
<li>utilize <a href="https://ntcore.com/explorer-suite/" target="_blank" rel="noopener noreferrer">CFF explorer</a>: examine the file structure and metadata,</li>
</ul>
</li>
<li><strong>Perform preliminary analysis</strong> - Use analysis tools to gather initial insights into the file’s behaviour and characteristics:<!-- -->
<ul>
<li>identify the hash: Compute the file hash and search in malware databases to determine if it is a known or new threat,</li>
<li>perform string analysis: Use <code>strings.exe</code> to extract readable text from the file,</li>
<li>search for filenames: if possible, identify the original filename and research it online for additional context,</li>
<li>use sandbox analysis: execute the file in a controlled environment to observe behaviour and extract further information,</li>
</ul>
</li>
<li><strong>Identify the next steps (if necessary)</strong>:<!-- -->
<ul>
<li>for example, identify configuration or Command and Control (C&amp;C) Server.</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysing-malicious-files">Analysing Malicious Files<a href="#analysing-malicious-files" class="hash-link" aria-label="Direct link to Analysing Malicious Files" title="Direct link to Analysing Malicious Files">​</a></h2>
<p>Attackers frequently deliver malicious files through <strong>spam emails</strong> and other <strong>attack vectors</strong>. This section covers methods for analysing different file types commonly used in malware distribution.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="xls-files"><code>.xls</code> files<a href="#xls-files" class="hash-link" aria-label="Direct link to xls-files" title="Direct link to xls-files">​</a></h3>
<p>Microsoft Excel files (<code>.xls</code>, <code>.xlsm</code>) can contain <strong>macros</strong>, which attackers use to execute malicious code.
Attackers can easily embed macros in malicious documents using the following methods:</p>
<ul>
<li><em>Right-click Menu</em> → <em>Assign Macro...</em></li>
<li><em>View</em> → <em>Macros</em> → <em>View Macros</em></li>
<li><em>Worksheet Tab</em>* → <em>Insert</em> (to add macros)</li>
<li><em>Worksheet Tab</em> → <em>View Code</em> (opens Microsoft Visual Basic for Applications - VBA)</li>
</ul>
<p>Attackers often protect macro access with passwords, making direct extraction difficult. Alternative methods are required to extract and analyse embedded macros.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="extracting-macros-with-oletools">Extracting Macros with <code>oletools</code><a href="#extracting-macros-with-oletools" class="hash-link" aria-label="Direct link to extracting-macros-with-oletools" title="Direct link to extracting-macros-with-oletools">​</a></h4>
<p><a href="http://www.decalage.info/python/oletools" target="_blank" rel="noopener noreferrer">oletools</a> is a Python toolkit for analysing <a href="http://en.wikipedia.org/wiki/Compound_File_Binary_Format" target="_blank" rel="noopener noreferrer">Microsoft OLE2 files</a> (used in legacy Office formats like <code>.doc</code>, <code>.xls</code>, <code>.ppt</code>). Install it with:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip install oletools</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Key <code>oletools</code> Commands:</p>
<ul>
<li><code>olemeta &lt;filename&gt;</code> - extracts (standard) metadata, useful for threat hunting and identifying similar malicious samples,</li>
<li><code>oleid &lt;filename&gt;</code> - detect specific characteristics usually found in malicious files, such as macros,</li>
<li><code>olevba &lt;filename&gt;</code> - extracts macro source code for analysis.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="analysing-extracted-macros">Analysing Extracted Macros<a href="#analysing-extracted-macros" class="hash-link" aria-label="Direct link to Analysing Extracted Macros" title="Direct link to Analysing Extracted Macros">​</a></h4>
<p>Malware macros are often <strong>obfuscated</strong> to hide their true functionality. For example, during the analysis look for:</p>
<ul>
<li>obfuscated strings hiding URLs or commands,</li>
<li>download-and-execute functions, such as: <code>rundll32.exe URL,Function</code>.</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Since 2023, Microsoft <strong>blocks automatic macro execution</strong> for files downloaded from the web, reducing but not eliminating the threat.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pdf-files"><code>.pdf</code> files<a href="#pdf-files" class="hash-link" aria-label="Direct link to pdf-files" title="Direct link to pdf-files">​</a></h3>
<p><a href="https://medium.com/@jberkenbilt/the-structure-of-a-pdf-file-6f08114a58f6" target="_blank" rel="noopener noreferrer">PDFs are structured documents</a> that can contain hidden malicious code. While they can be analyzed with a text editor, reading them directly is often challenging due to compression and encoding mechanisms. <a href="https://github.com/digitalsleuth/peepdf-3" target="_blank" rel="noopener noreferrer"><code>peepdf-3</code></a> is a powerful Python tool designed to simplify PDF analysis, allowing analysts to extract JavaScript code, embedded objects, and suspicious URLs efficiently.</p>
<p>Install it with:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip install peepdf-3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="basic-commands">Basic Commands<a href="#basic-commands" class="hash-link" aria-label="Direct link to Basic Commands" title="Direct link to Basic Commands">​</a></h4>
<p>Open a PDF in interactive mode: <code>peepdf -i &lt;filename&gt;</code>. Look for <strong>suspicious objects and streams</strong>, as they may contain embedded JavaScript/JS objects or external URLs (e.g., phishing links or download sites)</p>
<p>Use interactive mode:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&gt; help # list the possible commands</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; object &lt;object_number&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Attackers may use <strong>URL obfuscation</strong> to make a malicious domain look legitimate:</p>
<ul>
<li><code>scheme://[user:password@]host[:port]/path[?query][#fragment]</code>,</li>
<li>example: <code>https://docs.google.comformasda....@maliousdomain.com/</code></li>
</ul>
<p>An analyst may believe that the link leads to Google Docs, but it actually redirects to a malicious site that initiates the <strong>malware execution chain</strong>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="iso-img-lnk"><code>.iso</code>, <code>.img</code>, <code>.lnk</code><a href="#iso-img-lnk" class="hash-link" aria-label="Direct link to iso-img-lnk" title="Direct link to iso-img-lnk">​</a></h3>
<ul>
<li><code>.iso</code> / <code>.img</code> files are used as containers for additional malicious files (<code>.dll</code>). Users may not notice <code>.dll</code> file presence if they have <code>Show hidden files, folders, and drives</code> option disabled.</li>
<li><code>.lnk</code> shortcut files to execute malware: check the file properties → <code>Target</code> to identify the command being executed. For example, <code>C:\Windows\system32\rundll32.exe malicious.dll, malicious_fun</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dll-dynamic-link-library-files"><code>.dll</code> (Dynamic Link Library) Files<a href="#dll-dynamic-link-library-files" class="hash-link" aria-label="Direct link to dll-dynamic-link-library-files" title="Direct link to dll-dynamic-link-library-files">​</a></h3>
<p>Attackers can hijack a legitimate DLL (<a href="https://www.okta.com/identity-101/dll-hijacking/" target="_blank" rel="noopener noreferrer">DLL Hijacking</a>), injecting malicious functions while retaining original functionality. DLL files expose functions through the <strong>export table</strong>, making it possible to identify added malicious functions. You can use <a href="https://ntcore.com/explorer-suite/" target="_blank" rel="noopener noreferrer">CFF explorer</a> to start analysing a DLL file.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="msi-microsoft-installer-files"><code>.msi</code> (Microsoft Installer) Files<a href="#msi-microsoft-installer-files" class="hash-link" aria-label="Direct link to msi-microsoft-installer-files" title="Direct link to msi-microsoft-installer-files">​</a></h3>
<p><code>.msi</code> files can be misused to install malware. Attackers often embed <code>.dll</code> payloads inside <code>.msi</code> packages.</p>
<p>Install <a href="https://learn.microsoft.com/en-us/windows/win32/msi/orca-exe" target="_blank" rel="noopener noreferrer"><code>Orca.exe</code></a> via <strong>Windows SDK Installer</strong> (select &quot;MSI Tools&quot; during installation). Localize <code>Orca-x86_en-us.msi</code> and install it. To analyse an <code>.msi</code> file with<code> Orca.exe</code>, simply drag and drop the file into the application.</p>
<p>Inspect tables such as:</p>
<ul>
<li><strong>File Table</strong> → Lists all embedded files (e.g., <code>.dll</code>, <code>.exe</code>),</li>
<li><strong>CustomAction Table</strong> → may reveals execution commands (e.g., launching <code>rundll32.exe malicious.dll, malicious_fun</code>).</li>
</ul>
<p>You can also extract files from <code>.msi</code> using 7-Zip. You can also find <code>.cab</code> files inside <code>.msi</code> packages and can be used as hidden containers for malicious payloads.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="script-based-malware">Script-based Malware<a href="#script-based-malware" class="hash-link" aria-label="Direct link to Script-based Malware" title="Direct link to Script-based Malware">​</a></h2>
<p><strong>Multi-Stage Unpacking</strong> - Malware often executes in <strong>stages</strong>, requiring step-by-step unpacking to reveal the final payload.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="powershell">PowerShell<a href="#powershell" class="hash-link" aria-label="Direct link to PowerShell" title="Direct link to PowerShell">​</a></h3>
<p>PowerShell (<code>.ps1</code> scripts) is a powerful scripting language commonly used in the early stages of malware attacks for automation, system reconnaissance, and payload execution.</p>
<p>By default, PowerShell restricts script execution from third-party sources. To enable it, use: <code>Set-ExecutionPolicy RemoteSigned</code>.</p>
<p>Possible tools for analysis:</p>
<ul>
<li><strong>Visual Studio Code + PowerShell Extension</strong>: ideal for debugging and script analysis,</li>
<li><strong>PowerShell ISE</strong>: a built-in tool for script execution and debugging.</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>(<em>Optional</em>) Depending on the malware under analysis: <strong>disabling network access in the virtual machine</strong> can help prevent accidental internet requests, unauthorized data exfiltration, or command-and-control communication.</p></div></div>
<p>Malicious PowerShell scripts often use <a href="https://learn.microsoft.com/en-us/windows/win32/apiindex/windows-api-list" target="_blank" rel="noopener noreferrer">Windows API</a> - functions like:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DllImport(&quot;kernel32.dll&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">VirtualAlloc(...)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Scripts may execute other threads or process. You can use <a href="https://systeminformer.com/" target="_blank" rel="noopener noreferrer">System Informer</a> to inspect active processes, read and dump process memory for further analysis.
For example, you can load memory dumps into a binary analysis tool like <a href="https://ntcore.com/explorer-suite/" target="_blank" rel="noopener noreferrer">CFF explorer</a>, which includes a &quot;Quick Disassembler&quot; for low-level inspection.</p>
<p>PowerShell-based malware is often heavily obfuscated, using techniques such variable and function renaming, reversing or encoding strings. To improve readability, deobfuscation is recommended. Since doing this manually can be tedious and time-consuming, consider using deobfuscation tools or writing a simple script to automate the process.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="javascript-jscript-and-vbscript">JavaScript, JScript and VBScript<a href="#javascript-jscript-and-vbscript" class="hash-link" aria-label="Direct link to JavaScript, JScript and VBScript" title="Direct link to JavaScript, JScript and VBScript">​</a></h3>
<p>JavaScript usually runs within a sandboxed browser environment and does not have direct system privileges, unless browser vulnerabilities are exploited. On Windows, <a href="https://staff.cdms.westernsydney.edu.au/~jianhua/SAP_300165/tutorials/Practical_3_files/WSHCh01.pdf" target="_blank" rel="noopener noreferrer">Windows Script Host</a> provides an environment in which users can execute scripts in various languages that use various object models to perform tasks.</p>
<p>A JavaScript malware can be debugged using: <strong>Visual Studio + Windows Script Host</strong>.
In Visual Studio settings you can set the debugger: <code>cscript.exe //X $(ItemPath)</code></p>
<p>Useful websites:</p>
<ul>
<li><a href="https://obfuscator.io/" target="_blank" rel="noopener noreferrer">JavaScript Obfuscator</a>,</li>
<li><a href="https://deobfuscate.io/" target="_blank" rel="noopener noreferrer">JavaScript Deobfuscator</a>.</li>
</ul>
<p>VBScript is a deprecated programming language for scripting on Microsoft Windows using Component Object Model, based on classic Visual Basic and Active Scripting. (<a href="https://en.wikipedia.org/wiki/VBScript" target="_blank" rel="noopener noreferrer">Wiki</a>, <a href="https://learn.microsoft.com/en-us/previous-versions/windows/desktop/automat/activex-objects" target="_blank" rel="noopener noreferrer"><code>ActiveXObject</code></a>).</p>
<p><code>.hta</code> files executed via the <code>mshta.exe</code> utility, can often used as script containers for malware. Learn more: <a href="https://redcanary.com/threat-detection-report/techniques/mshta/" target="_blank" rel="noopener noreferrer">Red Canary - mshta Attack Technique</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="portable-executable-pe-format">Portable Executable (PE) Format<a href="#portable-executable-pe-format" class="hash-link" aria-label="Direct link to Portable Executable (PE) Format" title="Direct link to Portable Executable (PE) Format">​</a></h2>
<p>Portable Executable (PE) format is a file format for executables used in Windows operating systems, it’s based on the COFF file format (Common Object File Format). A PE file is a data structure that holds information necessary for the OS loader to be able to load that executable into memory and execute it. PE file extensions include <code>.exe</code>, <code>.dll</code>, <code>.scr</code>, and <code>.sys</code>. More details <a href="https://learn.microsoft.com/en-us/windows/win32/debug/pe-format" target="_blank" rel="noopener noreferrer">here</a> in the Microsoft documentation.</p>
<p>When analysing PE binaries, consider the differences between <em>managed and unmanaged languages</em>, <em>little endian vs big endian</em> when interpreting hex data, and <em>memory mapping</em>, as file offsets and in-memory addresses often differ. <a href="https://systeminformer.com/" target="_blank" rel="noopener noreferrer">System Informer</a> can be used to analyse memory.</p>
<p>Some articles for further reading:</p>
<ul>
<li><a href="https://developingthefuture.net/compilation-process-and-jit-compiler/" target="_blank" rel="noopener noreferrer">The Process of Compilation in C++, Java and .Net</a>,</li>
<li><a href="https://stackoverflow.com/questions/3563870/difference-between-managed-and-unmanaged" target="_blank" rel="noopener noreferrer">Difference between &quot;managed&quot; and &quot;unmanaged&quot;</a>,</li>
<li><a href="https://www.digital-detective.net/understanding-big-and-little-endian-byte-order/" target="_blank" rel="noopener noreferrer">Understanding Big and Little Endian Byte Order</a>,</li>
<li><a href="https://learn.microsoft.com/en-us/windows/win32/memory/memory-management" target="_blank" rel="noopener noreferrer">Memory Management</a> (Microsoft doc),</li>
<li>Wikipedia: <a href="https://en.wikipedia.org/wiki/Address_space" target="_blank" rel="noopener noreferrer">Address space</a>, <a href="https://en.wikipedia.org/wiki/Virtual_memory" target="_blank" rel="noopener noreferrer">Virtual memory</a>, <a href="https://en.wikipedia.org/wiki/Virtual_address_space" target="_blank" rel="noopener noreferrer">Virtual address space</a>.</li>
</ul>
<p>Below are the main sections commonly found in the PE format:</p>
<ul>
<li><code>DOS Header</code>
<ul>
<li><code>e_magic</code>: signature <strong>MZ</strong> (indicates a valid DOS executable),</li>
<li><code>e_lfanew</code>: offset where the <strong>NT Header</strong> starts,</li>
</ul>
</li>
<li><code>NT Header</code>
<ul>
<li><code>File Header</code>, contains general information about the PE file, including the target architecture,</li>
<li><code>Optional Header</code> (despite the name, it’s required for executables):<!-- -->
<ul>
<li><code>Magic</code>: Identifies whether the file is 32-bit (<code>0x10B</code>) or 64-bit (<code>0x20B</code>),</li>
<li><code>AddressOfEntryPoint</code>: Entry point for execution (where execution starts),</li>
<li><code>ImageBase</code>: Preferred memory address where the file should be loaded,</li>
<li><code>DllCharacteristics</code>: If ASLR is enabled, the DLL can be relocated in memory, impacting malware analysis,</li>
<li><strong>Data Directories</strong>: pointers to key structures such as the <strong>Import Table, Export Table, and Resource Table</strong>,</li>
</ul>
</li>
</ul>
</li>
<li>Section Headers<!-- -->
<ul>
<li><code>.text</code>: contains executable code,</li>
<li><code>.rdata</code>,<code>.data</code>: store read-only and writable data, such as strings and variables,</li>
</ul>
</li>
<li><code>Import Directory</code>: lists DLLs and functions the executable depends on. Example:<!-- -->
<ul>
<li><code>kernel32.dll</code>: common Windows API functions,</li>
<li><code>IsDebuggerPresent</code>: often used by malware to detect if it’s running in a debugging environment.</li>
</ul>
</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>In <a href="https://ntcore.com/explorer-suite/" target="_blank" rel="noopener noreferrer">CFF explorer</a> , go to the Optional Header section, then click on 	the <code>DllCharacteristics</code> row, <code>DLL can move</code>→ enable/disable ASLR option.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="net">.NET<a href="#net" class="hash-link" aria-label="Direct link to .NET" title="Direct link to .NET">​</a></h3>
<p>Machine code disassembly cannot process a managed language compiled executable because it is not native machine code. Instead, it must be disassembled from the intermediate language using an appropriate disassembler. Managed files are easier to decompile because they contain additional metadata, such as symbol names, class structures, and method definitions.</p>
<ul>
<li><a href="https://github.com/dnSpyEx/dnSpy" target="_blank" rel="noopener noreferrer">dnSpyEx</a> is a debugger and .NET assembly editor. Go to entry point and start analyse it,</li>
<li><a href="https://github.com/de4dot/de4dot" target="_blank" rel="noopener noreferrer">de4dot</a> is a .NET deobfuscator and unpacker written in C#. Here the compiled binaries: <a href="https://github.com/vee2xx/de4dot-built-binaries" target="_blank" rel="noopener noreferrer">de4dot-built-binaries</a>,</li>
<li><code>ildasm.exe</code> - is an intermediate language disassembler, <a href="https://learn.microsoft.com/en-us/dotnet/framework/tools/ildasm-exe-il-disassembler" target="_blank" rel="noopener noreferrer">docs</a>. Usage examples:<!-- -->
<ul>
<li><code>ildasm file.exe /out:file.il</code></li>
<li><code>ilasm file.il /out:file_m.exe</code></li>
</ul>
</li>
</ul>
<p>While inspecting .NET code, look for some of the following instructions:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Can be used to load second-stage payloads in memory </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Assembly.Load( ... )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># function from kernel32.dll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># allocate memory with execution rights</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">VirtualAlloc(...) </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><a href="https://systeminformer.com/" target="_blank" rel="noopener noreferrer">System Informer</a> has a .NET Assemblies tab, which can be used to inspect loaded .NET assemblies within a process. This feature allows to detect suspicious or injected .NET assemblies, which may indicate malware activity.</p>
<p><a href="https://github.com/enkomio/shed" target="_blank" rel="noopener noreferrer">shed (.NET Runtime Inspector)</a>, dnSpyEx, or <a href="https://systeminformer.com/" target="_blank" rel="noopener noreferrer">System Informer</a> can be used to analyse .NET processes and extract loaded binaries.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="unmanaged-code">Unmanaged code<a href="#unmanaged-code" class="hash-link" aria-label="Direct link to Unmanaged code" title="Direct link to Unmanaged code">​</a></h3>
<p><em>Requirements</em>: knowledge of <a href="https://en.wikipedia.org/wiki/Assembly_language" target="_blank" rel="noopener noreferrer">Assembly language</a>, how stack and heap works, <a href="https://learn.microsoft.com/en-us/cpp/build/x64-calling-convention" target="_blank" rel="noopener noreferrer">Windows calling convention</a></p>
<ul>
<li><a href="https://x64dbg.com/" target="_blank" rel="noopener noreferrer">x64dbg</a> open-source x64/x32 debugger for windows,<!-- -->
<ul>
<li>To emulate what a malware does we can load <code>rundll32.exe</code> and pass the DLL under analysis to the command  (Option → Settings → User DLL Load),</li>
</ul>
</li>
<li><a href="https://github.com/hasherezade/pe-sieve" target="_blank" rel="noopener noreferrer">PE-sieve</a>is a tool that helps to detect malware running on the system, as well as to collect the potentially malicious material for further analysis. Recognizes and dumps variety of implants within the scanned process: replaced/injected PEs, shellcodes, hooks, and other in-memory patches,</li>
<li><a href="https://ghidra-sre.org/" target="_blank" rel="noopener noreferrer">Ghidra</a> is a software reverse engineering (SRE) framework,</li>
<li>Other alternatives: <a href="https://hex-rays.com/ida-pro" target="_blank" rel="noopener noreferrer">IDA Pro</a>, <a href="https://binary.ninja/" target="_blank" rel="noopener noreferrer">Binary Ninja</a>, <a href="https://rada.re/" target="_blank" rel="noopener noreferrer">radare2</a>, <a href="https://github.com/icedland/iced" target="_blank" rel="noopener noreferrer">iced-rs</a>.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="yara-rules">YARA rules<a href="#yara-rules" class="hash-link" aria-label="Direct link to YARA rules" title="Direct link to YARA rules">​</a></h2>
<p><a href="https://virustotal.github.io/yara/" target="_blank" rel="noopener noreferrer">YARA</a> is a powerful tool designed primarily for malware researchers to <strong>identify and classify malware samples</strong>. It allows users to create <em>rules</em> that describe malware families (or any other artifacts) using <em>textual or binary patterns</em>. Each rule consists of a <em>set of strings</em> and a <em>boolean expression</em> that defines its detection logic.</p>
<p>Suggestions for crafting an effective YARA rule:</p>
<ul>
<li>identify meaningful strings or format strings within the malware,</li>
<li>look for imported libraries and function names that indicate malicious behaviour,</li>
<li>consider obfuscation techniques, malware may encode or manipulate critical strings to evade detection.</li>
</ul>
<p>Beware of false positives and false negatives when creating YARA rules. While false positives can lead to unnecessary alerts, false negatives are more dangerous, as they allow malware to go undetected. Test YARA rules extensively. Examples of YARA rules can be found on the <a href="https://yara.readthedocs.io/en/latest/" target="_blank" rel="noopener noreferrer">documentation</a>.</p>
<p>Running YARA from the command-line</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yara64 &lt;rule file&gt; &lt;binary to analyse&gt; | &lt;PID&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><a href="https://www.unpac.me/" target="_blank" rel="noopener noreferrer">UNPACME</a> is an automated malware unpacking service and it can be used for YARA development, testing, and hunting.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="malware-analysis-report">Malware Analysis Report<a href="#malware-analysis-report" class="hash-link" aria-label="Direct link to Malware Analysis Report" title="Direct link to Malware Analysis Report">​</a></h2>
<p>Malware analysis reports provide critical insights into a threat, serving as the key output of the analysis process. A report should help assess impact and understand the threat.</p>
<p>A well-structured report combines strategic and technical details, covering the malware’s nature, operators, targets, and in-depth analysis of its functions, payloads, and behaviours.</p>
<p>Examples of malware reports:</p>
<ul>
<li><a href="https://www.ncsc.gov.uk/section/keep-up-to-date/malware-analysis-reports" target="_blank" rel="noopener noreferrer">Reports and IoCs from the NCSC malware analysis team</a>,</li>
<li><a href="https://any.run/malware-reports/" target="_blank" rel="noopener noreferrer">ANY.RUN</a> malicious database - provides free access to many public reports,</li>
<li><a href="https://thedfirreport.com/" target="_blank" rel="noopener noreferrer">The DFIR Report</a>,</li>
<li>WikiLoader: <a href="https://www.proofpoint.com/us/blog/threat-insight/out-sandbox-wikiloader-digs-sophisticated-evasion" target="_blank" rel="noopener noreferrer">https://www.proofpoint.com/us/blog/threat-insight/out-sandbox-wikiloader-digs-sophisticated-evasion</a>.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="vocabulary-tips-and-resources">Vocabulary, Tips and Resources<a href="#vocabulary-tips-and-resources" class="hash-link" aria-label="Direct link to Vocabulary, Tips and Resources" title="Direct link to Vocabulary, Tips and Resources">​</a></h2>
<ul>
<li>A <strong>malware sandbox</strong> is a virtual environment used to isolate and analyse the behaviour of potentially malicious software. It execute a file and trace all the operations that are performed,</li>
<li><a href="https://www.cloudflare.com/learning/security/what-are-indicators-of-compromise/" target="_blank" rel="noopener noreferrer"><strong>Indicators of Compromise</strong> (IOCs)</a> are evidence left behind by an attacker or malware that can be used to identify a security incident. Common examples include file hashes, IP addresses, domain names, or registry changes. They are often included in analysis reports to support detection and response efforts;</li>
<li><a href="https://sysdig.com/learn-cloud-native/what-is-a-command-and-control-server/" target="_blank" rel="noopener noreferrer"><strong>Command and Control (C&amp;C) Server</strong></a> is a server controlled by an attacker to is used to deliver malware, issue commands, exfiltrate data, or coordinate further attacks on targeted systems,</li>
<li><strong>Packer</strong>: utility used to compress and obfuscate files, making them more difficult to analyse. Malware often leverages packers to evade detection by antivirus software,</li>
<li><strong>AsyncRAT</strong> is a Remote Access Tool (RAT) designed to remotely monitor and control other computers through a secure encrypted connection,</li>
<li><strong>Quackbot</strong> is a famous banking trojan, more <a href="https://www.darktrace.com/cyber-ai-glossary/qakbot" target="_blank" rel="noopener noreferrer">here</a>,</li>
<li><strong>Autostart Extension Points (ASEP)</strong> are commonly used by malware as <a href="https://www.infosecinstitute.com/resources/malware-analysis/common-malware-persistence-mechanisms/" target="_blank" rel="noopener noreferrer">persistence mechanisms</a> and define a starting point for the malware,</li>
<li><a href="https://learn.microsoft.com/en-en/sysinternals/" target="_blank" rel="noopener noreferrer">Sysinternals</a>:<!-- -->
<ul>
<li><code>Autoruns64.exe</code>, useful to list and reports auto-start services and many other things,</li>
<li><code>string.exe</code> usage example: <code>string.exe -n 20 file.exe</code>, list all string of 20 character in the executable,</li>
</ul>
</li>
<li><a href="https://github.com/ret42/RE-Thing" target="_blank" rel="noopener noreferrer">ret42/RE-Thing</a> - list of reverse eng. tools,</li>
<li>ired.team notes: <a href="https://www.ired.team/miscellaneous-reversing-forensics/windows-kernel-internals" target="_blank" rel="noopener noreferrer">miscellaneous-reversing-forensics</a>,</li>
<li><a href="https://cyberlab.pacific.edu/resources/reverse-engineering-cheat-sheets/analyzing-malicious-document-files.pdf" target="_blank" rel="noopener noreferrer">reverse-engineering-cheat-sheets</a>.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="software-obfuscation-techniques">Software Obfuscation Techniques<a href="#software-obfuscation-techniques" class="hash-link" aria-label="Direct link to Software Obfuscation Techniques" title="Direct link to Software Obfuscation Techniques">​</a></h4>
<p>Attackers use <strong>obfuscation techniques</strong> to evade detection and analysis. Common transformations include:</p>
<ul>
<li><strong>String Encoding</strong> – Hiding commands, URLs, and payloads.</li>
<li><strong>Control Flow Flattening</strong> – Making code execution paths difficult to follow.</li>
<li><strong>Packing and Encryption</strong> – Wrapping malicious code inside additional layers to avoid detection.</li>
</ul>
<p>For a detailed breakdown of obfuscation methods, refer to:<br>
<a href="https://tigress.wtf/transformations.html" target="_blank" rel="noopener noreferrer">Tigress - Software Obfuscation Transformations</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="attck-matrix">ATT&amp;CK Matrix<a href="#attck-matrix" class="hash-link" aria-label="Direct link to ATT&amp;CK Matrix" title="Direct link to ATT&amp;CK Matrix">​</a></h4>
<p><a href="https://attack.mitre.org/" target="_blank" rel="noopener noreferrer">MITRE ATT&amp;CK</a> is a globally-accessible knowledge base of adversary tactics and techniques based on real-world observations.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/security">security</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/malware-analysis">malware-analysis</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/keystone-enclave"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Keystone Enclave</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#environment-for-malware-analysis" class="table-of-contents__link toc-highlight">Environment for malware analysis</a><ul><li><a href="#host-requirements" class="table-of-contents__link toc-highlight">Host requirements</a></li><li><a href="#guest-requirements" class="table-of-contents__link toc-highlight">Guest requirements</a></li></ul></li><li><a href="#threat-hunting-and-malware-triage" class="table-of-contents__link toc-highlight">Threat Hunting and Malware Triage</a></li><li><a href="#analysing-malicious-files" class="table-of-contents__link toc-highlight">Analysing Malicious Files</a><ul><li><a href="#xls-files" class="table-of-contents__link toc-highlight"><code>.xls</code> files</a></li><li><a href="#pdf-files" class="table-of-contents__link toc-highlight"><code>.pdf</code> files</a></li><li><a href="#iso-img-lnk" class="table-of-contents__link toc-highlight"><code>.iso</code>, <code>.img</code>, <code>.lnk</code></a></li><li><a href="#dll-dynamic-link-library-files" class="table-of-contents__link toc-highlight"><code>.dll</code> (Dynamic Link Library) Files</a></li><li><a href="#msi-microsoft-installer-files" class="table-of-contents__link toc-highlight"><code>.msi</code> (Microsoft Installer) Files</a></li></ul></li><li><a href="#script-based-malware" class="table-of-contents__link toc-highlight">Script-based Malware</a><ul><li><a href="#powershell" class="table-of-contents__link toc-highlight">PowerShell</a></li><li><a href="#javascript-jscript-and-vbscript" class="table-of-contents__link toc-highlight">JavaScript, JScript and VBScript</a></li></ul></li><li><a href="#portable-executable-pe-format" class="table-of-contents__link toc-highlight">Portable Executable (PE) Format</a><ul><li><a href="#net" class="table-of-contents__link toc-highlight">.NET</a></li><li><a href="#unmanaged-code" class="table-of-contents__link toc-highlight">Unmanaged code</a></li></ul></li><li><a href="#yara-rules" class="table-of-contents__link toc-highlight">YARA rules</a></li><li><a href="#malware-analysis-report" class="table-of-contents__link toc-highlight">Malware Analysis Report</a></li><li><a href="#vocabulary-tips-and-resources" class="table-of-contents__link toc-highlight">Vocabulary, Tips and Resources</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Luca Giorgino. Built with Docusaurus. Image by storyset on <a href="https://www.freepik.com">Freepik</a></div></div></div></footer></div>
</body>
</html>