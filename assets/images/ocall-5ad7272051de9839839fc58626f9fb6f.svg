<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="573px" preserveAspectRatio="none" style="width:1069px;height:573px;background:#FFFFFF;" version="1.1" viewBox="0 0 1069 573" width="1069px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="34.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="150" y="311.4922"/><rect fill="#DFFF00" height="438.125" style="stroke:#181818;stroke-width:1.0;" width="10" x="457.5" y="75.4297"/><rect fill="#FFFFFF" height="366.8594" style="stroke:#181818;stroke-width:1.0;" width="10" x="644.5" y="146.6953"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="155" x2="155" y1="36.2969" y2="566.6875"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="401" x2="401" y1="36.2969" y2="566.6875"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="462" x2="462" y1="36.2969" y2="566.6875"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="649" x2="649" y1="36.2969" y2="566.6875"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="835" x2="835" y1="36.2969" y2="566.6875"/><rect fill="#D3D3D3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118" x="96" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104" x="103" y="24.9951">UntrustedHost</text><rect fill="#D3D3D3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="34" x="384" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="20" x="391" y="24.9951">OS</text><rect fill="#87CEFA" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="69" x="428" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="435" y="24.9951">Enclave</text><rect fill="#87CEFA" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="75" x="612" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="619" y="24.9951">Runtime</text><rect fill="#87CEFA" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="129" x="771" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="778" y="24.9951">SecurityMonitor</text><rect fill="#FFFFFF" height="34.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="150" y="311.4922"/><rect fill="#DFFF00" height="438.125" style="stroke:#181818;stroke-width:1.0;" width="10" x="457.5" y="75.4297"/><rect fill="#FFFFFF" height="366.8594" style="stroke:#181818;stroke-width:1.0;" width="10" x="644.5" y="146.6953"/><line style="stroke:#C92750;stroke-width:1.0;" x1="462.5" x2="509.5" y1="62.4297" y2="62.4297"/><line style="stroke:#C92750;stroke-width:1.0;" x1="509.5" x2="509.5" y1="62.4297" y2="75.4297"/><line style="stroke:#C92750;stroke-width:1.0;" x1="468.5" x2="509.5" y1="75.4297" y2="75.4297"/><polygon fill="#C92750" points="478.5,71.4297,468.5,75.4297,478.5,79.4297,474.5,75.4297" style="stroke:#C92750;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="474.5" y="57.3638">1</text><text fill="#C92750" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="160" x="487.5" y="57.3638">ocall_do_something()</text><polygon fill="#181818" points="637.5,105.5625,647.5,109.5625,637.5,113.5625,641.5,109.5625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="467.5" x2="643.5" y1="109.5625" y2="109.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="474.5" y="104.4966">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="487.5" y="104.4966">ocall()</text><line style="stroke:#181818;stroke-width:1.0;" x1="649.5" x2="696.5" y1="133.6953" y2="133.6953"/><line style="stroke:#181818;stroke-width:1.0;" x1="696.5" x2="696.5" y1="133.6953" y2="146.6953"/><line style="stroke:#181818;stroke-width:1.0;" x1="655.5" x2="696.5" y1="146.6953" y2="146.6953"/><polygon fill="#181818" points="665.5,142.6953,655.5,146.6953,665.5,150.6953,661.5,146.6953" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8" x="661.5" y="128.6294">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="673.5" y="128.6294">dispatch_edgecall_ocall()</text><line style="stroke:#181818;stroke-width:1.0;" x1="654.5" x2="696.5" y1="180.8281" y2="180.8281"/><line style="stroke:#181818;stroke-width:1.0;" x1="696.5" x2="696.5" y1="180.8281" y2="193.8281"/><line style="stroke:#181818;stroke-width:1.0;" x1="655.5" x2="696.5" y1="193.8281" y2="193.8281"/><polygon fill="#181818" points="665.5,189.8281,655.5,193.8281,665.5,197.8281,661.5,193.8281" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="661.5" y="175.7622">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="674.5" y="175.7622">copy_from_user()</text><polygon fill="#181818" points="823.5,244.6602,833.5,248.6602,823.5,252.6602,827.5,248.6602" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="654.5" x2="829.5" y1="248.6602" y2="248.6602"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="661.5" y="243.5942">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="674.5" y="243.5942">sbi_stop_enclave()</text><path d="M840,206.8281 L840,276.8281 L1062,276.8281 L1062,216.8281 L1052,206.8281 L840,206.8281 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1052,206.8281 L1052,216.8281 L1062,216.8281 L1052,206.8281 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="846" y="223.895">enclaves[eid].state = STOPPED</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="846" y="239.0278">context_switch_to_host()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="846" y="254.1606">osm_pmp_set()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="846" y="269.2935">cpu_exit_enclave_context()</text><line style="stroke:#181818;stroke-width:1.0;" x1="155" x2="202" y1="298.4922" y2="298.4922"/><line style="stroke:#181818;stroke-width:1.0;" x1="202" x2="202" y1="298.4922" y2="311.4922"/><line style="stroke:#181818;stroke-width:1.0;" x1="161" x2="202" y1="311.4922" y2="311.4922"/><polygon fill="#181818" points="171,307.4922,161,311.4922,171,315.4922,167,311.4922" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="167" y="293.4263">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="180" y="293.4263">oFuncDispatch(getSharedBuffer())</text><polygon fill="#C92750" points="11,341.625,1,345.625,11,349.625,7,345.625" style="stroke:#C92750;stroke-width:1.0;"/><line style="stroke:#C92750;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="5" x2="154" y1="345.625" y2="345.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="17" y="340.5591">7</text><text fill="#C92750" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="118" x="30" y="340.5591">do_something()</text><polygon fill="#181818" points="389,370.7578,399,374.7578,389,378.7578,393,374.7578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="155" x2="395" y1="374.7578" y2="374.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="162" y="369.6919">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="175" y="369.6919">ioctl()</text><polygon fill="#181818" points="823.5,399.8906,833.5,403.8906,823.5,407.8906,827.5,403.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="401" x2="829.5" y1="403.8906" y2="403.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="408" y="398.8247">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="421" y="398.8247">sbi_sm_resume_enclave()</text><polygon fill="#181818" points="665.5,454.7227,655.5,458.7227,665.5,462.7227,661.5,458.7227" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="659.5" x2="834.5" y1="458.7227" y2="458.7227"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="671.5" y="453.6567">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="694.5" y="453.6567">resume_enclave()</text><path d="M840,416.8906 L840,486.8906 L1060,486.8906 L1060,426.8906 L1050,416.8906 L840,416.8906 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1050,416.8906 L1050,426.8906 L1060,426.8906 L1050,416.8906 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="846" y="433.9575">enclaves[eid].state = RUNNING</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="846" y="449.0903">context_switch_to_enclave()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="846" y="464.2231">osm_pmp_set()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="846" y="479.356">cpu_enter_enclave_context()</text><polygon fill="#181818" points="473.5,509.5547,463.5,513.5547,473.5,517.5547,469.5,513.5547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="467.5" x2="648.5" y1="513.5547" y2="513.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="479.5" y="508.4888">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="501.5" y="508.4888">copy_to_user()</text><path d="M387,526.5547 L387,551.5547 L537,551.5547 L537,536.5547 L527,526.5547 L387,526.5547 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M527,526.5547 L527,536.5547 L537,536.5547 L527,526.5547 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="393" y="543.6216">execution continues</text><!--MD5=[bedbd16b723f109af7071aeb059208d4]
@startuml
autonumber
hide footbox
participant UntrustedHost as UH #d3d3d3
participant OS as OS #d3d3d3
participant Enclave as E 		#87cefa
participant Runtime as RT		#87cefa
participant SecurityMonitor as SM		#87cefa

    E -[#c92750]> E: <color #c92750>**ocall_do_something()**</color> 
        activate E #DFFF00
            
            E -> RT: ocall()
            RT -> RT: dispatch_edgecall_ocall()
            activate RT 
                RT-> RT: copy_from_user()
                RT-> SM: sbi_stop_enclave()
                note right
                    enclaves[eid].state = STOPPED
                    context_switch_to_host()
                    osm_pmp_set()
                    cpu_exit_enclave_context()
                end note
                UH -> UH: oFuncDispatch(getSharedBuffer())
    
                activate UH 
                    [<-[#c92750]-UH: <color #c92750>**do_something()**</color> 
                deactivate UH
                UH-> OS: ioctl()
                OS-> SM: sbi_sm_resume_enclave()
                SM-> RT: resume_enclave()
                note right
                enclaves[eid].state = RUNNING
                context_switch_to_enclave()
                osm_pmp_set()
                cpu_enter_enclave_context()
                end note
                RT-> E: copy_to_user()
            deactivate RT
            
            note over E: execution continues
        deactivate E
@enduml

PlantUML version 1.2022.8beta2(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>